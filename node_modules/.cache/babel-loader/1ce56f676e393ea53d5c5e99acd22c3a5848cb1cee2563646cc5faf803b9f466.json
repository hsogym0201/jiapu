{"ast":null,"code":"import \"core-js/modules/esnext.iterator.map.js\";\nimport * as d3 from \"d3\";\nimport { sankey, sankeyLinkHorizontal } from \"d3-sankey\";\nexport default {\n  name: \"SangJiTu\",\n  props: {\n    sankeyData: Object // 从父组件传递过来的桑基图数据\n  },\n  mounted() {\n    this.initChart();\n  },\n  watch: {\n    sankeyData(newData) {\n      if (newData && newData.nodes.length > 0) {\n        this.updateChart(newData); // 当数据变化时更新桑基图\n      }\n    }\n  },\n  methods: {\n    initChart() {\n      this.svg = d3.select(\"#SangJiTU\").append(\"svg\").attr(\"width\", \"100%\").attr(\"height\", 700);\n    },\n    updateChart(sankeyData) {\n      // 清空之前的内容\n      this.svg.selectAll(\"*\").remove();\n      const width = document.getElementById(\"SangJiTU\").offsetWidth;\n      const height = 700;\n      const sankeyGenerator = sankey().nodeWidth(20).nodePadding(15).extent([[0, 0], [width, height]]);\n\n      // 应用数据\n      const {\n        nodes,\n        links\n      } = sankeyGenerator({\n        nodes: sankeyData.nodes.map(d => Object.assign({}, d)),\n        links: sankeyData.links.map(d => Object.assign({}, d))\n      });\n\n      // 绘制链接\n      this.svg.append(\"g\").selectAll(\"path\").data(links).join(\"path\").attr(\"d\", sankeyLinkHorizontal()).attr(\"fill\", \"none\").attr(\"stroke\", d => d.color || \"#aaa\").attr(\"stroke-width\", d => Math.max(1, d.width)).attr(\"opacity\", 0.7);\n\n      // 绘制节点\n      this.svg.append(\"g\").selectAll(\"rect\").data(nodes).join(\"rect\").attr(\"x\", d => d.x0).attr(\"y\", d => d.y0).attr(\"width\", d => d.x1 - d.x0).attr(\"height\", d => d.y1 - d.y0).attr(\"fill\", \"#69b3a2\").attr(\"stroke\", \"#000\");\n\n      // 添加节点标签\n      this.svg.append(\"g\").selectAll(\"text\").data(nodes).join(\"text\").attr(\"x\", d => d.x0 - 6).attr(\"y\", d => (d.y1 + d.y0) / 2).attr(\"dy\", \"0.35em\").attr(\"text-anchor\", \"end\").text(d => d.name).attr(\"font-size\", \"12px\").attr(\"fill\", \"#333\");\n\n      // 添加列标签\n      const columnLabels = [\"始祖原居地\", \"始祖迁居地\", \"始迁祖原居地\", \"始迁祖迁居地\"];\n      columnLabels.forEach((label, i) => {\n        this.svg.append(\"text\").attr(\"x\", i * width / 4 + width / 8).attr(\"y\", height - 20).attr(\"text-anchor\", \"middle\").attr(\"font-size\", \"16px\").attr(\"font-weight\", \"bold\").text(label);\n      });\n    }\n  }\n};","map":{"version":3,"names":["d3","sankey","sankeyLinkHorizontal","name","props","sankeyData","Object","mounted","initChart","watch","newData","nodes","length","updateChart","methods","svg","select","append","attr","selectAll","remove","width","document","getElementById","offsetWidth","height","sankeyGenerator","nodeWidth","nodePadding","extent","links","map","d","assign","data","join","color","Math","max","x0","y0","x1","y1","text","columnLabels","forEach","label","i"],"sources":["D:\\project\\idea-project\\jiapudemo1\\jiapudemo1\\src\\components\\SangJiTu.vue"],"sourcesContent":["<template>\r\n  <div class=\"SangJiTu\">\r\n    <div id=\"SangJiTU\"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as d3 from \"d3\";\r\nimport { sankey, sankeyLinkHorizontal } from \"d3-sankey\";\r\n\r\nexport default {\r\n  name: \"SangJiTu\",\r\n  props: {\r\n    sankeyData: Object, // 从父组件传递过来的桑基图数据\r\n  },\r\n  mounted() {\r\n    this.initChart();\r\n  },\r\n  watch: {\r\n    sankeyData(newData) {\r\n      if (newData && newData.nodes.length > 0) {\r\n        this.updateChart(newData); // 当数据变化时更新桑基图\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    initChart() {\r\n      this.svg = d3\r\n          .select(\"#SangJiTU\")\r\n          .append(\"svg\")\r\n          .attr(\"width\", \"100%\")\r\n          .attr(\"height\", 700);\r\n    },\r\n\r\n    updateChart(sankeyData) {\r\n      // 清空之前的内容\r\n      this.svg.selectAll(\"*\").remove();\r\n\r\n      const width = document.getElementById(\"SangJiTU\").offsetWidth;\r\n      const height = 700;\r\n\r\n      const sankeyGenerator = sankey()\r\n          .nodeWidth(20)\r\n          .nodePadding(15)\r\n          .extent([\r\n            [0, 0],\r\n            [width, height],\r\n          ]);\r\n\r\n      // 应用数据\r\n      const { nodes, links } = sankeyGenerator({\r\n        nodes: sankeyData.nodes.map(d => Object.assign({}, d)),\r\n        links: sankeyData.links.map(d => Object.assign({}, d)),\r\n      });\r\n\r\n      // 绘制链接\r\n      this.svg\r\n          .append(\"g\")\r\n          .selectAll(\"path\")\r\n          .data(links)\r\n          .join(\"path\")\r\n          .attr(\"d\", sankeyLinkHorizontal())\r\n          .attr(\"fill\", \"none\")\r\n          .attr(\"stroke\", d => d.color || \"#aaa\")\r\n          .attr(\"stroke-width\", d => Math.max(1, d.width))\r\n          .attr(\"opacity\", 0.7);\r\n\r\n      // 绘制节点\r\n      this.svg\r\n          .append(\"g\")\r\n          .selectAll(\"rect\")\r\n          .data(nodes)\r\n          .join(\"rect\")\r\n          .attr(\"x\", d => d.x0)\r\n          .attr(\"y\", d => d.y0)\r\n          .attr(\"width\", d => d.x1 - d.x0)\r\n          .attr(\"height\", d => d.y1 - d.y0)\r\n          .attr(\"fill\", \"#69b3a2\")\r\n          .attr(\"stroke\", \"#000\");\r\n\r\n      // 添加节点标签\r\n      this.svg\r\n          .append(\"g\")\r\n          .selectAll(\"text\")\r\n          .data(nodes)\r\n          .join(\"text\")\r\n          .attr(\"x\", d => d.x0 - 6)\r\n          .attr(\"y\", d => (d.y1 + d.y0) / 2)\r\n          .attr(\"dy\", \"0.35em\")\r\n          .attr(\"text-anchor\", \"end\")\r\n          .text(d => d.name)\r\n          .attr(\"font-size\", \"12px\")\r\n          .attr(\"fill\", \"#333\");\r\n\r\n      // 添加列标签\r\n      const columnLabels = [\"始祖原居地\", \"始祖迁居地\", \"始迁祖原居地\", \"始迁祖迁居地\"];\r\n      columnLabels.forEach((label, i) => {\r\n        this.svg\r\n            .append(\"text\")\r\n            .attr(\"x\", (i * width) / 4 + width / 8)\r\n            .attr(\"y\", height - 20)\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .attr(\"font-size\", \"16px\")\r\n            .attr(\"font-weight\", \"bold\")\r\n            .text(label);\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.SangJiTu {\r\n  width: 100%;\r\n  text-align: center;\r\n}\r\n#SangJiTU {\r\n  width: 100%;\r\n  height: 700px;\r\n  margin: 20px auto;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}